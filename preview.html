<!DOCTYPE html>
<html>
<!-- 
Por Antônio Felipe Almeida Costa 
Página criada como entrega para o curso XR
Disponível em: https://github.com/falmeidaco/ra1
-->

<head>
    <title>AR Pato que pula</title>
    <!-- bibliotecas -->
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>

    <!-- estilização das instruções da página -->
    <style>
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-size: 18px;
            font-family: Arial, Helvetica, sans-serif;
        }

        .mensagem-hero {
            text-align: center;
            position: fixed;
            z-index: 9999;
            background: white;
            font-size: 1rem;
            padding: 1rem;
            width: 100%;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        a {
            text-decoration: underline;
        }

        .instrucoes {
            background: rgba(255, 255, 255, .7);
            position: fixed;
            bottom: 1rem;
            left: 1rem;
            padding: .7rem;
            border-radius: 1rem;
            display: none;
        }

        ul,
        ul li {
            font-size: .8rem;
            list-style: none;
            margin: 0;
            padding: 0
        }

        li:last-child {
            margin-top: .8rem;
            font-size: .6rem;
            text-align: center;
        }
    </style>
</head>

<body>
    <!-- Elementos dinâmicos -->
    <a-scene>
        <a-assets>
            <img id="placa-onibus" src="placa-onibus.png">
        </a-assets>

        <a-entity position="0 1 -5" scale="5 5 5" rotation="0 0 0"
            animation="dir: alternate; property: position; to: 0 1.2 -5; loop: true; dur: 1500; easing: easeInOutSine">
            <a-entity pin-onibus="text:301m; width:1"></a-entity>
        </a-entity>
    </a-scene>
    <script>

        /* COMPONENTE TAG TEXT */
        AFRAME.registerComponent('tag-text', {
            schema: {
                text: { default: "Texto" },
                width: { default: 1 },
                height: { default: 0.3 },
                background: { default: "#222" },
                color: { default: "#000" }
            },
            init: function () {
                const d = this.data;

                // Cria bordar e define cor
                const border = document.createElement('a-plane');
                border.setAttribute('width', d.width + 0.05);
                border.setAttribute('height', d.height + 0.05);
                border.setAttribute('color', d.color);
                border.setAttribute('position', '0 0 -.01');

                // Cria fundo do texto branco
                const bg = document.createElement('a-plane');
                bg.setAttribute('width', d.width);
                bg.setAttribute('height', d.height);
                bg.setAttribute('color', '#FFF');

                // Cria o texto
                const txt = document.createElement('a-text');
                txt.setAttribute('value', d.text);
                txt.setAttribute('color', d.color);
                txt.setAttribute('align', 'center');
                txt.setAttribute('position', `0 0 0.01`);

                this.el.appendChild(border);
                this.el.appendChild(bg);
                this.el.appendChild(txt);
            }
        });

        /* COMPONENTE PIN-ONIBUS */
        AFRAME.registerComponent('pin-onibus', {
            schema: {
                text: { default: "Texto" },
                width: { default: 1 },
            },
            init: function () {
                const d = this.data;

                /* Elemento 3D */
                const pin = document.createElement('a-entity')
                pin.setAttribute('gltf-model', 'url(map_pin.glb)')
                pin.setAttribute('animation', " property: rotation; to: 0 360 0; loop: true; dur: 1500; easing: easeInOutQuad");
                this.el.appendChild(pin);

                /* Placa de Onibus */
                const placa = document.createElement('a-circle');
                placa.setAttribute('position', '0 0.07 -0.05');
                placa.setAttribute('radius', '0.15');
                placa.setAttribute('material', 'src: #placa-onibus; color: white; shader: standard; repeat: 1 1; side: double')
                this.el.appendChild(placa);

                /* Tag com texto */
                const tag = document.createElement('a-entity');
                tag.setAttribute('position', '0 -.18 .1');
                tag.setAttribute('scale', '.4 .4 .4');
                tag.setAttribute('tag-text', `text:${d.text}; width: ${d.width};`)
                this.el.appendChild(tag);
            }
        });
    </script>
</body>

</html>